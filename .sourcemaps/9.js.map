{"version":3,"sources":["../../src/pages/record-data/record-data.module.ts","../../src/pages/record-data/record-data.ts"],"names":[],"mappings":"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","file":"9.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { RecordDataPage } from './record-data';\r\n\r\n@NgModule({\r\n  declarations: [RecordDataPage],\r\n  imports: [\r\n    IonicPageModule.forChild(RecordDataPage)    \r\n  ],\r\n  exports: [\r\n    RecordDataPage\r\n  ]\r\n})\r\nexport class RecordDataPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/record-data/record-data.module.ts","import { Component } from '@angular/core';\r\nimport { NavController, IonicPage } from 'ionic-angular';\r\nimport {KoboApi} from \"../../providers/kobo-api\";\r\n// import {Observable} from 'rxjs/Observable'\r\nimport {ModalController} from \"ionic-angular\"\r\nimport { StorageProvider } from '../../providers/storage/storage'\r\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\r\n\r\n\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-record-data',\r\n  templateUrl: 'record-data.html',\r\n})\r\n\r\nexport class RecordDataPage {\r\n  results: any = [];\r\n  anyErrors: boolean;\r\n  finished: boolean = false;\r\n  refreshing: boolean = false;\r\n  forms: any = [];\r\n  formOpen: boolean = false;\r\n  enketoLink: any;\r\n  formDisplay: string = 'none';\r\n  user: any={id:'id not registered'}\r\n\r\n  constructor(\r\n    public koboApi: KoboApi,\r\n    public nav: NavController,\r\n    public modal: ModalController,\r\n    private storagePrvdr: StorageProvider,\r\n    public sanitizer: DomSanitizer) {\r\n    // can move to storage provider code\r\n    this.storagePrvdr.get('forms').then((forms)=> {\r\n        if (forms) {\r\n            this.forms = forms\r\n        }\r\n        else {\r\n            this.finished = false;\r\n            this.getForms()\r\n        }\r\n    })\r\n    console.log('getting user from storage')\r\n    this.storagePrvdr.getUser().then((user) => {\r\n      console.log('user retrieved',user)\r\n      this.user=user\r\n    })\r\n  }\r\n\r\n  getForms() {\r\n    this.refreshing = true;\r\n    this.anyErrors=false;\r\n    this.koboApi.koboRequest('https://kc.kobotoolbox.org/api/v1/forms').subscribe(\r\n      result => {\r\n        this.forms = result\r\n        this.refreshing=false\r\n      }  ,\r\n        error => {\r\n          console.log(error);\r\n          this.anyErrors = true;\r\n          this.finished = true;\r\n          this.refreshing = false\r\n        },\r\n        () => {\r\n          this.finished = true;\r\n          this.refreshing = false\r\n          let i=0;\r\n          this.storagePrvdr.set('forms',this.forms);\r\n          for(let form of this.forms){\r\n            this.getLinks(form, i);\r\n            i++\r\n          }}\r\n    );\r\n  }\r\n\r\n  getLinks(form, index){\r\n    this.koboApi.koboRequest(form.url + '/enketo').subscribe(\r\n        //**need to also save link to cache\r\n        result =>{\r\n          this.forms[index].enketoLink = result['enketo_url'].replace('https://','http://')\r\n        },\r\n        error =>{console.log(error)},\r\n        () => {\r\n          this.storagePrvdr.set('forms',this.forms);\r\n        })\r\n  }\r\n\r\n  openForm(form) {\r\n    console.log('form',form)\r\n    console.log('enketo link', form.enketoLink)\r\n    //http://ee.kobotoolbox.org/x/#YCOj\r\n    var stringLength = form.enketoLink.length\r\n    var linkPrefix = form.enketoLink.slice(0, stringLength - 7)\r\n    var linkSuffix = form.enketoLink.slice(stringLength - 5)\r\n    var link = linkPrefix + '_/?d[/'+form.id_string+'/User_ID_from_Tablet]=' + this.user.id + linkSuffix\r\n    console.log('link',link)\r\n    this.formOpen = true;\r\n    this.enketoLink = this.sanitizer.bypassSecurityTrustResourceUrl(link);\r\n    this.formDisplay='block'\r\n  }\r\n  closeForm() {\r\n    this.formOpen = false;\r\n    this.formDisplay = 'none'\r\n  }\r\n\r\n\r\n  refresh(){\r\n    console.log('refreshing');\r\n    this.finished=false;\r\n    this.getForms();\r\n  }\r\n\r\n\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/record-data/record-data.ts"],"sourceRoot":""}